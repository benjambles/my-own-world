import { pool } from '../../utils/utils';
import { sql } from 'pg-extra';

export default const migration = {
    /**
     * Uses semver - auto generated to be the latest minor bump unless param is passed into generator
     */
    version: '%apply_version%',
    /**
     * Upgrade code
     */
    up: function(){
        let status = await pool._query(sql`
        
        `);

        if (!status) throw new Error(`Error whilst applying migration for v${%apply_version}`);

        return await pool._query(sql`
            UPDATE System
            SET "value" = "%apply_version%"
            WHERE "key" = "db_version"
            returning "value"
        `); 
    },
    /**
     * Rollback code - Don't remove the version rollback query;
     */
    down: function(){
        let status = await pool._query(sql`
        
        `);

        if (!status) throw new Error(`Error whilst reverting to migration for v${%revert_version}`);

        return await pool._query(sql`
            UPDATE System
            SET "value" = "%revert_version%"
            WHERE "key" = "db_version"
            returning "value"
        `);
    }
}